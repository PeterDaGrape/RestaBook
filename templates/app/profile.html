{% extends 'app/base.html' %}

{% block title_block %}
    Your Profile
{% endblock %}

{% block body_block %}
    <h1>Welcome, {{ user.username }}!</h1>
    <p>Email: {{ user.email }}</p>

    <hr>

    <h2>Your Bookings</h2>
    {% if bookings %}
        <ul>
            {% for booking in bookings %}
                <li>
                    <strong>Restaurant:</strong> {{ booking.restaurant.name }}<br>
                    <strong>Date:</strong> {{ booking.date }}<br>
                    <strong>Time:</strong> {{ booking.time }}<br>
                    <strong>Guests:</strong> {{ booking.number_of_guests }}<br>
                    <strong>Status:</strong>
                    {% if booking.is_completed %}
                        Completed
                    {% else %}
                        Not Completed

                        <form method="post" action="{% url 'app:cancel_booking' booking.id %}">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-sm btn-danger">Cancel Booking</button>
                        </form>

                        <form method="post" action="{% url 'app:complete_booking' booking.id %}">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-sm btn-success">Mark as Completed</button>
                        </form>
                    {% endif %}

                </li>
                <hr>
            {% endfor %}
        </ul>
    {% else %}
        <p>You have no bookings yet.</p>
    {% endif %}

    <div class="pagination">
        {% if bookings.has_previous %}
            <a href="?booking_page=1">« First</a>
            <a href="?booking_page={{ bookings.previous_page_number }}">‹ Prev</a>
        {% endif %}
    
        Page {{ bookings.number }} of {{ bookings.paginator.num_pages }}
    
        {% if bookings.has_next %}
            <a href="?booking_page={{ bookings.next_page_number }}">Next ›</a>
            <a href="?booking_page={{ bookings.paginator.num_pages }}">Last »</a>
        {% endif %}
    </div>
    
    

    <hr>

    <h2>Your Reviews</h2>
    {% if reviews %}
        <ul>
            {% for review in reviews %}
                <li>
                    <strong>Restaurant:</strong> {{ review.restaurant.name }}<br>
                    <strong>Rating: </strong>
                    {% if review.star_rating == 1 %}
                        ⭐
                    {% endif %}
                    {% if review.star_rating == 2 %}
                        ⭐⭐
                    {% endif %}
                    {% if review.star_rating == 3 %}
                        ⭐⭐⭐
                    {% endif %}
                    {% if review.star_rating == 4 %}
                        ⭐⭐⭐⭐
                    {% endif %}
                    {% if review.star_rating == 5 %}
                        ⭐⭐⭐⭐⭐
                    {% endif %}
                    <br>

                    <strong>Comment:</strong> {{ review.comment }}<br>
                    <strong>Posted on:</strong> {{ review.review_date }}
                </li>
                <hr>
            {% endfor %}
        </ul>
    {% else %}
        <p>You have not reviewed any restaurants yet.</p>
    {% endif %}

    <div class="pagination">
        {% if reviews.has_previous %}
            <a href="?review_page=1">« First</a>
            <a href="?review_page={{ reviews.previous_page_number }}">‹ Prev</a>
        {% endif %}
    
        Page {{ reviews.number }} of {{ reviews.paginator.num_pages }}
    
        {% if reviews.has_next %}
            <a href="?review_page={{ reviews.next_page_number }}">Next ›</a>
            <a href="?review_page={{ reviews.paginator.num_pages }}">Last »</a>
        {% endif %}
    </div>

    <hr>

{% endblock %}

